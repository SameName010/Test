-- LocalScript: Speed & Jump GUI (Blox Fruits) - PC + Mobile
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer

-- Config
local MIN_SPEED, MAX_SPEED = 100, 300
local MIN_JUMP, MAX_JUMP = 100, 300

-- ================= GUI =================
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "SpeedJumpGUI"
screenGui.Parent = player:WaitForChild("PlayerGui")
screenGui.ResetOnSpawn = false

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 260, 0, 120)
frame.Position = UDim2.new(0.3,0,0.3,0)
frame.BackgroundColor3 = Color3.fromRGB(25,25,25)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true
frame.Parent = screenGui

local frameCorner = Instance.new("UICorner")
frameCorner.CornerRadius = UDim.new(0, 8)
frameCorner.Parent = frame

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1,0,0,30)
title.Position = UDim2.new(0,0,0,0)
title.BackgroundTransparency = 1
title.Font = Enum.Font.SourceSansBold
title.TextSize = 20
title.TextColor3 = Color3.fromRGB(255,255,255)
title.Text = "Speed & Jump by Name`"

local inputContainer = Instance.new("Frame")
inputContainer.Size = UDim2.new(1, -20, 0, 80)
inputContainer.Position = UDim2.new(0, 10, 0, 35)
inputContainer.BackgroundTransparency = 1
inputContainer.Parent = frame

local uiList = Instance.new("UIListLayout")
uiList.FillDirection = Enum.FillDirection.Vertical
uiList.SortOrder = Enum.SortOrder.LayoutOrder
uiList.Padding = UDim.new(0, 10)
uiList.Parent = inputContainer

local function createInput(name, defaultText)
    local holder = Instance.new("Frame")
    holder.Size = UDim2.new(1, 0, 0, 30)
    holder.BackgroundTransparency = 1
    holder.Parent = inputContainer

    local label = Instance.new("TextLabel", holder)
    label.Size = UDim2.new(0.35,0,1,0)
    label.Position = UDim2.new(0,0,0,0)
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.SourceSans
    label.TextSize = 20
    label.TextColor3 = Color3.fromRGB(255,255,255)
    label.Text = name

    local box = Instance.new("TextBox", holder)
    box.Size = UDim2.new(0.6,0,1,0)
    box.Position = UDim2.new(0.4,0,0,0)
    box.BackgroundColor3 = Color3.fromRGB(40,40,40)
    box.BorderSizePixel = 0
    box.TextColor3 = Color3.fromRGB(255,255,255)
    box.Font = Enum.Font.SourceSans
    box.TextSize = 20
    box.ClearTextOnFocus = false
    box.PlaceholderText = defaultText
    box.Text = defaultText

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0,5)
    corner.Parent = box

    return box
end

local speedBox = createInput("Speed:", "150")
local jumpBox = createInput("Jump:", "100")

-- Toggle button
local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(0, 45, 0, 45)
toggleBtn.Position = UDim2.new(0.02,0,0.02,0)
toggleBtn.BackgroundColor3 = Color3.fromRGB(70,70,70)
toggleBtn.TextColor3 = Color3.fromRGB(255,255,255)
toggleBtn.Font = Enum.Font.SourceSansBold
toggleBtn.TextSize = 16
toggleBtn.Text = "ON"
toggleBtn.Active = true
toggleBtn.Draggable = true
toggleBtn.Parent = screenGui

local toggleCorner = Instance.new("UICorner")
toggleCorner.CornerRadius = UDim.new(0,5)
toggleCorner.Parent = toggleBtn

toggleBtn.MouseButton1Click:Connect(function()
    frame.Visible = not frame.Visible
    toggleBtn.Text = frame.Visible and "ON" or "OFF"
end)

-- ================= Buff logic =================
local function getRoot()
    local char = player.Character or player.CharacterAdded:Wait()
    return char:FindFirstChild("HumanoidRootPart")
end

local function getHumanoid()
    local char = player.Character or player.CharacterAdded:Wait()
    return char:FindFirstChildOfClass("Humanoid")
end

-- Hàm tạo BodyVelocity
local function setupBV()
    local root = getRoot()
    if root and not root:FindFirstChild("SpeedBV") then
        local bv = Instance.new("BodyVelocity")
        bv.Name = "SpeedBV"
        bv.MaxForce = Vector3.new(1e5,0,1e5)
        bv.P = 1250
        bv.Velocity = Vector3.new(0,0,0)
        bv.Parent = root
    end
end

-- Khi respawn
player.CharacterAdded:Connect(function()
    wait(0.1)
    setupBV()
end)

-- Cập nhật liên tục speed & jump
RunService.Heartbeat:Connect(function()
    local hum = getHumanoid()
    local root = getRoot()
    if hum and root then
        local speed = math.clamp(tonumber(speedBox.Text) or 125, MIN_SPEED, MAX_SPEED)
        local jump = math.clamp(tonumber(jumpBox.Text) or 100, MIN_JUMP, MAX_JUMP)

        hum.JumpPower = jump

        local bv = root:FindFirstChild("SpeedBV")
        if not bv then
            setupBV()
            bv = root:FindFirstChild("SpeedBV")
        end

        if bv then
            local moveDir = hum.MoveDirection
            -- Nếu đang đứng yên thì không làm trôi nhân vật
            if moveDir.Magnitude > 0 then
                bv.Velocity = moveDir.Unit * speed
            else
                bv.Velocity = Vector3.new(0,0,0)
            end
        end
    end
end)